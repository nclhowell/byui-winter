{"ast":null,"code":"import { HttpHeaders } from '@angular/common/http';\nimport { EventEmitter } from '@angular/core';\nimport { Subject } from 'rxjs';\nimport * as i0 from \"@angular/core\";\nimport * as i1 from \"@angular/common/http\";\nexport class DocumentService {\n  constructor(httpClient) {\n    this.httpClient = httpClient;\n    // mongoURIdocuments: string = \"https://wdd430cms0-default-rtdb.firebaseio.com/documents.json\";\n    this.mongoURIdocuments = 'http://localhost:3000/documents';\n    this.jsondocs = [];\n    this.documentSelectedEvent = new EventEmitter();\n    this.documentChangedEvent = new EventEmitter();\n    this.documentListChanged = new Subject();\n    // this.documents = MOCKDOCUMENTS;\n    this.documents = this.getDocuments();\n    console.log('Constructor mongoDocs =', this.documents);\n    //  this.jsondocs = this.getDocuments();\n    // this.documents = this.getDocuments();\n    // console.log('mockDocs = ', this.documents);\n    // console.log(\"Web Docs Array = \", this.webdocuments);\n    // this.maxDocumentId = this.getMaxDocumentId();\n    // console.log(\"Max Doc ID =\", this.maxDocumentId);\n  }\n  // getDocuments() {\n  //   this.httpClient\n  //     .get<{ message: string; documents: Document[] }>(this.mongoURIdocuments)\n  //     .subscribe((documentsData) => {\n  //       console.log('It works!');\n  //       this.documents = documentsData.documents;\n  //       response.status(200).json({\n  //         message: 'Docs fetched successfully'\n  //          documents: documents });\n  //       });\n  //sortAndSend() {\n  // this.documents.sort((a, b) => {\n  //   if (a.name < b.name) {\n  //     return -1;\n  //   }\n  //   if (a.name > b.name) {\n  //     return 1;\n  //   }\n  //   return 0;\n  // });\n  //       this.documentListChanged.next(this.documents.slice());\n  //     });\n  // }\n  getDocuments() {\n    this.httpClient\n    // .get<{documents: Document[]}>(this.mongoURIdocuments)\n    .get(this.mongoURIdocuments).subscribe(docs => {\n      this.documents = docs;\n      console.log('getDocuuments mongoDocs =', this.documents);\n      this.maxDocumentId = this.getMaxDocumentId();\n      // Alphabetical Sort\n      // this.documents.sort((a, b) => {\n      //   if (a.name < b.name) {\n      //     return -1;\n      //   }\n      //   if (a.name > b.name) {\n      //     return 1;\n      //   }\n      //   return 0;\n      // });\n      // this.documentListChanged.next(this.documents.slice());\n    });\n\n    return this.documents.slice();\n  }\n  getDocument(id) {\n    for (const document of this.documents) {\n      if (document.id == id) {\n        //console.log(\"found!\")\n        return document;\n      }\n    }\n    return null;\n  }\n  addDocument(document) {\n    if (!document) {\n      return;\n    }\n    // make sure id of the new Document is empty\n    document.id = '';\n    const headers = new HttpHeaders({\n      'Content-Type': 'application/json'\n    });\n    // add to database\n    this.httpClient.post('http://localhost:3000/documents', document, {\n      headers: headers\n    }).subscribe(responseData => {\n      // add new document to documents\n      this.documents.push(responseData.document);\n      this.sortAndSend();\n    });\n  }\n  // addDocument(newDocument: Document) {\n  //   if (newDocument == undefined || newDocument == null) {\n  //     return;\n  //   }\n  //   this.maxDocumentId++;\n  //   newDocument.id = String(this.maxDocumentId);\n  //   this.documents.push(newDocument)\n  //   this.storeDocuments();\n  // }\n  // updateDocument(originalDocument: Document, newDocument: Document) {\n  //   if (originalDocument == null || originalDocument == null || originalDocument == undefined || originalDocument == undefined) {\n  //     return;\n  //   }\n  //   const pos = this.documents.indexOf(originalDocument);\n  //   if (pos < 0) {\n  //     return;\n  //   }\n  //   newDocument.id = originalDocument.id;\n  //   this.documents[pos] = newDocument;\n  //   this.storeDocuments();\n  // }\n  updateDocument(originalDocument, newDocument) {\n    if (!originalDocument || !newDocument) {\n      return;\n    }\n    const pos = this.documents.findIndex(d => d.id === originalDocument.id);\n    if (pos < 0) {\n      return;\n    }\n    // set the id of the new Document to the id of the old Document\n    newDocument.id = originalDocument.id;\n    // newDocument._id = originalDocument._id;\n    const headers = new HttpHeaders({\n      'Content-Type': 'application/json'\n    });\n    // update database\n    this.httpClient.put('http://localhost:3000/documents/' + originalDocument.id, newDocument, {\n      headers: headers\n    }).subscribe(response => {\n      this.documents[pos] = newDocument;\n      this.sortAndSend();\n    });\n  }\n  // deleteDocument(document: Document) {\n  //   if (!document) {\n  //     return;\n  //   }\n  //   const pos = this.documents.indexOf(document);\n  //   if (pos < 0) {\n  //     return;\n  //   }\n  //   this.documents.splice(pos, 1);\n  //   this.storeDocuments();\n  // }\n  deleteDocument(document) {\n    if (!document) {\n      return;\n    }\n    const pos = this.documents.findIndex(d => d.id === document.id);\n    if (pos < 0) {\n      return;\n    }\n    // delete from database\n    this.httpClient.delete('http://localhost:3000/documents/' + document.id).subscribe(response => {\n      this.documents.splice(pos, 1);\n      this.sortAndSend();\n    });\n  }\n  getMaxDocumentId() {\n    //return this.documents.sort(d=>d.id)[0];\n    let maxId = 0;\n    for (const document of this.documents) {\n      if (+document.id > maxId) {\n        maxId = +document.id;\n      }\n    }\n    return maxId;\n  }\n  storeDocuments() {\n    this.httpClient.put(this.mongoURIdocuments, JSON.stringify(this.documents), {\n      headers: new HttpHeaders({\n        'Content-Type': 'application/json'\n      })\n    }).subscribe({\n      next: () => this.documentListChanged.next(this.documents.slice()),\n      error: evar => console.error('Error saving documents: ', evar)\n    });\n  }\n  sortAndSend() {\n    this.documents.sort((a, b) => {\n      if (a.name < b.name) {\n        return -1;\n      }\n      if (a.name > b.name) {\n        return 1;\n      }\n      return 0;\n    });\n    this.documentListChanged.next(this.documents.slice());\n  }\n}\nDocumentService.ɵfac = function DocumentService_Factory(t) {\n  return new (t || DocumentService)(i0.ɵɵinject(i1.HttpClient));\n};\nDocumentService.ɵprov = /*@__PURE__*/i0.ɵɵdefineInjectable({\n  token: DocumentService,\n  factory: DocumentService.ɵfac,\n  providedIn: 'root'\n});","map":{"version":3,"mappings":"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","names":["HttpHeaders","EventEmitter","Subject","DocumentService","constructor","httpClient","documents","getDocuments","console","log","get","mongoURIdocuments","subscribe","docs","maxDocumentId","getMaxDocumentId","slice","getDocument","id","document","addDocument","headers","post","responseData","push","sortAndSend","updateDocument","originalDocument","newDocument","pos","findIndex","d","put","response","deleteDocument","delete","splice","maxId","storeDocuments","JSON","stringify","next","documentListChanged","error","evar","sort","a","b","name","factory","providedIn"],"sourceRoot":"","sources":["C:\\data\\A-byu\\Full Stack Dev WDD 430\\code\\wdd430\\byui-winter\\week11\\cms\\src\\app\\documents\\document.service.ts"],"sourcesContent":["import { HttpClient, HttpHeaders } from '@angular/common/http';\nimport { EventEmitter, Injectable, OnInit } from '@angular/core';\nimport { Subject } from 'rxjs';\nimport { Document } from './documents.model';\nimport { MOCKDOCUMENTS } from './MOCKDOCUMENTS';\nimport { json } from 'body-parser';\nimport { response } from 'express';\n\n@Injectable({\n  providedIn: 'root',\n})\nexport class DocumentService {\n  // mongoURIdocuments: string = \"https://wdd430cms0-default-rtdb.firebaseio.com/documents.json\";\n  mongoURIdocuments: string = 'http://localhost:3000/documents';\n  jsondocs: Document[] = [];\n  // documents: Document[] = MOCKDOCUMENTS;\n  documents: Document[];\n  documentSelectedEvent = new EventEmitter<Document>();\n  documentChangedEvent = new EventEmitter<Document[]>();\n  documentListChanged = new Subject<Document[]>();\n  maxDocumentId: number;\n\n  constructor(private httpClient: HttpClient) {\n  // this.documents = MOCKDOCUMENTS;\n  this.documents = this.getDocuments();\n  console.log('Constructor mongoDocs =', this.documents);\n  //  this.jsondocs = this.getDocuments();\n  // this.documents = this.getDocuments();\n\n\n   // console.log('mockDocs = ', this.documents);\n   // console.log(\"Web Docs Array = \", this.webdocuments);\n   // this.maxDocumentId = this.getMaxDocumentId();\n   // console.log(\"Max Doc ID =\", this.maxDocumentId);\n  }\n\n  // getDocuments() {\n  //   this.httpClient\n  //     .get<{ message: string; documents: Document[] }>(this.mongoURIdocuments)\n  //     .subscribe((documentsData) => {\n  //       console.log('It works!');\n  //       this.documents = documentsData.documents;\n  //       response.status(200).json({\n  //         message: 'Docs fetched successfully'\n  //          documents: documents });\n  //       });\n\n        //sortAndSend() {\n        // this.documents.sort((a, b) => {\n        //   if (a.name < b.name) {\n        //     return -1;\n        //   }\n        //   if (a.name > b.name) {\n        //     return 1;\n        //   }\n        //   return 0;\n        // });\n  //       this.documentListChanged.next(this.documents.slice());\n  //     });\n  // }\n\n  getDocuments() {\n    this.httpClient\n      // .get<{documents: Document[]}>(this.mongoURIdocuments)\n      .get<Document[]>(this.mongoURIdocuments)\n      .subscribe((docs) => {\n       this.documents = docs;\n       console.log('getDocuuments mongoDocs =', this.documents);\n        this.maxDocumentId = this.getMaxDocumentId();\n        // Alphabetical Sort\n        // this.documents.sort((a, b) => {\n        //   if (a.name < b.name) {\n        //     return -1;\n        //   }\n        //   if (a.name > b.name) {\n        //     return 1;\n        //   }\n        //   return 0;\n        // });\n        // this.documentListChanged.next(this.documents.slice());\n      });\n     return this.documents.slice();\n  }\n\n  getDocument(id: string): Document {\n    for (const document of this.documents) {\n      if (document.id == id) {\n        //console.log(\"found!\")\n        return document;\n      }\n    }\n    return null;\n  }\n  addDocument(document: Document) {\n    if (!document) {\n      return;\n    }\n\n    // make sure id of the new Document is empty\n    document.id = '';\n\n    const headers = new HttpHeaders({ 'Content-Type': 'application/json' });\n\n    // add to database\n    this.httpClient\n      .post<{ message: string; document: Document }>(\n        'http://localhost:3000/documents',\n        document,\n        { headers: headers }\n      )\n      .subscribe((responseData) => {\n        // add new document to documents\n        this.documents.push(responseData.document);\n        this.sortAndSend();\n      });\n  }\n\n  // addDocument(newDocument: Document) {\n  //   if (newDocument == undefined || newDocument == null) {\n  //     return;\n  //   }\n\n  //   this.maxDocumentId++;\n  //   newDocument.id = String(this.maxDocumentId);\n  //   this.documents.push(newDocument)\n  //   this.storeDocuments();\n  // }\n\n  // updateDocument(originalDocument: Document, newDocument: Document) {\n  //   if (originalDocument == null || originalDocument == null || originalDocument == undefined || originalDocument == undefined) {\n  //     return;\n  //   }\n\n  //   const pos = this.documents.indexOf(originalDocument);\n  //   if (pos < 0) {\n  //     return;\n  //   }\n\n  //   newDocument.id = originalDocument.id;\n  //   this.documents[pos] = newDocument;\n  //   this.storeDocuments();\n  // }\n\n  updateDocument(originalDocument: Document, newDocument: Document) {\n    if (!originalDocument || !newDocument) {\n      return;\n    }\n\n    const pos = this.documents.findIndex((d) => d.id === originalDocument.id);\n\n    if (pos < 0) {\n      return;\n    }\n\n    // set the id of the new Document to the id of the old Document\n    newDocument.id = originalDocument.id;\n    // newDocument._id = originalDocument._id;\n\n    const headers = new HttpHeaders({ 'Content-Type': 'application/json' });\n\n    // update database\n    this.httpClient\n      .put(\n        'http://localhost:3000/documents/' + originalDocument.id,\n        newDocument,\n        { headers: headers }\n      )\n      .subscribe((response: Response) => {\n        this.documents[pos] = newDocument;\n        this.sortAndSend();\n      });\n  }\n\n  // deleteDocument(document: Document) {\n  //   if (!document) {\n  //     return;\n  //   }\n  //   const pos = this.documents.indexOf(document);\n  //   if (pos < 0) {\n  //     return;\n  //   }\n  //   this.documents.splice(pos, 1);\n  //   this.storeDocuments();\n  // }\n\n  deleteDocument(document: Document) {\n    if (!document) {\n      return;\n    }\n\n    const pos = this.documents.findIndex((d) => d.id === document.id);\n\n    if (pos < 0) {\n      return;\n    }\n\n    // delete from database\n    this.httpClient\n      .delete('http://localhost:3000/documents/' + document.id)\n      .subscribe((response: Response) => {\n        this.documents.splice(pos, 1);\n        this.sortAndSend();\n      });\n  }\n\n  getMaxDocumentId(): number {\n    //return this.documents.sort(d=>d.id)[0];\n    let maxId = 0;\n    for (const document of this.documents) {\n      if (+document.id > maxId) {\n        maxId = +document.id;\n      }\n    }\n    return maxId;\n  }\n\n  storeDocuments() {\n    this.httpClient\n      .put(this.mongoURIdocuments, JSON.stringify(this.documents), {\n        headers: new HttpHeaders({ 'Content-Type': 'application/json' }),\n      })\n      .subscribe({\n        next: () => this.documentListChanged.next(this.documents.slice()),\n        error: (evar) => console.error('Error saving documents: ', evar),\n      });\n  }\n\n  sortAndSend() {\n    this.documents.sort((a, b) => {\n      if (a.name < b.name) {\n        return -1;\n      }\n      if (a.name > b.name) {\n        return 1;\n      }\n      return 0;\n    });\n    this.documentListChanged.next(this.documents.slice());\n  }\n}\n"]},"metadata":{},"sourceType":"module","externalDependencies":[]}